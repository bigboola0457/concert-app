<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–Ω—Ç—Ä–æ–ª—å</title>

    <link rel="manifest" href="manifest.json">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 15px;
            max-width: 600px;
            margin: 0 auto;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.secondary {
            background-color: #6c757d;
        }
        button.secondary:hover {
            background-color: #545b62;
        }
        #search {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin: 15px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .guest {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .guest:hover {
            background-color: #f8f9fa;
        }
        .checked {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        .hidden {
            display: none;
        }
        .instructions {
            background-color: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            margin: 10px 0;
        }
        .debug {
            background-color: #fff3cd;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <h2>üé≠ –ö–æ–Ω—Ç—Ä–æ–ª—å</h2>

    <button onclick="toggleDebug()" style="background-color: #ffc107; color: black;">üêõ –û—Ç–ª–∞–¥–∫–∞</button>
    <div id="debugInfo" class="debug"></div>

    <div class="section" id="uploadSection">
        <h3>üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π</h3>
        <input type="text" id="eventNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;">
        <button onclick="showCompletedEvents()" class="secondary" style="margin-bottom: 15px;">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</button>
        <button id="continueActiveEventButton" onclick="continueActiveEvent()" class="secondary" style="margin-bottom: 15px; display: none;">‚ñ∂Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
        <div class="instructions">
            <strong>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞:</strong><br>
            1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫ –≤ –ø–æ–ª–µ –Ω–∏–∂–µ<br>
            2. –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ - –æ–¥–∏–Ω –≥–æ—Å—Ç—å<br>
            3. –ü—Ä–∏–º–µ—Ä:<br>
            <em>–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π (–§—Ä–µ–Ω–¥) +1<br>
            –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è (–ü—Ä–µ—Å—Å–∞)<br>
            –°–∏–¥–æ—Ä–æ–≤ –ü–µ—Ç—Ä (Vip)</em>
        </div>
        <textarea id="guestTextarea" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞..."></textarea>
        <div>
            <button id="loadButton">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <button onclick="clearAllData()" class="secondary">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
        </div>
        <div id="uploadStatus"></div>
    </div>

    <div class="section hidden" id="activeEventSection">
        <h3>‚ú® –ê–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h3>
        <div id="activeEventName" style="font-weight: bold; margin-bottom: 5px;"></div>
        <p>–í—Å–µ–≥–æ –≥–æ—Å—Ç–µ–π: <span id="activeEventTotalCount">0</span> | –û—Ç–º–µ—á–µ–Ω–æ: <span id="activeEventCheckedCount">0</span></p>
        <button onclick="showSearchForActiveEvent()">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∏—Å–∫—É</button>
        <button onclick="closeEvent()" class="secondary" style="background-color: #dc3545;">–ó–∞–≤–µ—Ä—à–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
    </div>

    <div class="section hidden" id="searchSection">
        <h3>üîç –ü–æ–∏—Å–∫ –≥–æ—Å—Ç–µ–π</h3>
        <div id="eventNameDisplay" style="font-weight: bold; margin-bottom: 10px;"></div>
        <input type="text" id="search" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏–ª–∏ –∏–º—è...">
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
            <input type="text" id="newGuestNameInput" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è" style="width: calc(100% - 110px); padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-right: 10px;">
            <button onclick="addGuest()" style="width: 100px; padding: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div id="guestList"></div>
        <div class="status">
            –í—Å–µ–≥–æ –≥–æ—Å—Ç–µ–π: <span id="totalCount">0</span> | 
            –ù–∞–π–¥–µ–Ω–æ: <span id="foundCount">0</span> | 
            –û—Ç–º–µ—á–µ–Ω–æ: <span id="checkedCount">0</span>
            <button onclick="showReport()" class="secondary" style="float: right;">–û—Ç—á–µ—Ç</button>
            <button onclick="backToUpload()" class="secondary" style="float: right; margin-right: 10px;">–ù–æ–≤—ã–π —Å–ø–∏—Å–æ–∫</button>
            <button onclick="closeEvent()" class="secondary" style="float: right; margin-right: 10px; background-color: #dc3545;">–ó–∞–∫—Ä—ã—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
            <button onclick="showCompletedEvents()" class="secondary" style="float: right; margin-right: 10px;">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</button>
        </div>
    </div>

    <div class="section hidden" id="completedEventsSection">
        <h3>‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
        <div id="completedEventsList"></div>
        <button onclick="backToSearchFromCompleted()" class="secondary">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
        <button onclick="clearCompletedEvents()" class="secondary" style="background-color: #dc3545;">–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</button>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const uploadSection = document.getElementById('uploadSection');
        const searchSection = document.getElementById('searchSection');
        const guestTextarea = document.getElementById('guestTextarea');
        const searchInput = document.getElementById('search');
        const guestList = document.getElementById('guestList');
        const foundCount = document.getElementById('foundCount');
        const checkedCount = document.getElementById('checkedCount');
        const totalCount = document.getElementById('totalCount');
        const uploadStatus = document.getElementById('uploadStatus');
        const debugInfo = document.getElementById('debugInfo');
        const eventNameInput = document.getElementById('eventNameInput');
        const eventNameDisplay = document.getElementById('eventNameDisplay');
        const completedEventsSection = document.getElementById('completedEventsSection');
        const completedEventsList = document.getElementById('completedEventsList');
        const activeEventSection = document.getElementById('activeEventSection');
        const activeEventName = document.getElementById('activeEventName');
        const activeEventTotalCount = document.getElementById('activeEventTotalCount');
        const activeEventCheckedCount = document.getElementById('activeEventCheckedCount');
        const continueActiveEventButton = document.getElementById('continueActiveEventButton');
        const newGuestNameInput = document.getElementById('newGuestNameInput');

        // –û—Ç–ª–∞–¥–∫–∞
        function debugLog(message) {
            debugInfo.innerHTML += message + '<br>';
            console.log(message);
        }

        function toggleDebug() {
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        function updateActiveEventDisplay() {
            const currentEventName = localStorage.getItem('eventName') || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            const savedGuests = JSON.parse(localStorage.getItem('guestList')) || [];
            const checkedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];

            activeEventName.textContent = `–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ: ${currentEventName}`;
            activeEventTotalCount.textContent = savedGuests.length;
            activeEventCheckedCount.textContent = checkedGuests.length;

            debugLog(`–û–±–Ω–æ–≤–ª–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ: ${currentEventName}, –í—Å–µ–≥–æ: ${savedGuests.length}, –û—Ç–º–µ—á–µ–Ω–æ: ${checkedGuests.length}`);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        function showSearchForActiveEvent() {
            activeEventSection.classList.add('hidden');
            searchSection.classList.remove('hidden');
            updateGuestDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π –≤ –ø–æ–∏—Å–∫–µ
            updateCounters(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –≤ –ø–æ–∏—Å–∫–µ
            debugLog('–ü–µ—Ä–µ—à–ª–∏ –≤ —Å–µ–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≥–æ—Å—Ç–µ–π
        function loadGuestList() {
            debugLog('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫"');
            
            const text = guestTextarea.value.trim();
            debugLog('–¢–µ–∫—Å—Ç –∏–∑ textarea: ' + (text ? '–µ—Å—Ç—å (' + text.length + ' —Å–∏–º–≤–æ–ª–æ–≤)' : '–ø—É—Å—Ç–æ–π'));

            if (!text) {
                uploadStatus.innerHTML = '<div style="color: red; margin-top: 10px;">‚ùå –í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ</div>';
                return;
            }

            const guests = text.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);

            debugLog('–ù–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–æ–∫: ' + guests.length);

            if (guests.length === 0) {
                uploadStatus.innerHTML = '<div style="color: red; margin-top: 10px;">‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≥–æ—Å—Ç–µ–π –≤ —Å–ø–∏—Å–∫–µ</div>';
                return;
            }

            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –≤ localStorage
                localStorage.setItem('guestList', JSON.stringify(guests));
                localStorage.setItem('checkedGuests', JSON.stringify([]));
                localStorage.setItem('eventName', eventNameInput.value.trim());
                debugLog('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
                uploadStatus.innerHTML = '<div style="color: green; margin-top: 10px;">–°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω! –ì–æ—Å—Ç–µ–π: ' + guests.length + '</div>';

                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–µ–ª —Å–æ–æ–±—â–µ–Ω–∏–µ
                setTimeout(() => {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                    uploadSection.classList.add('hidden');
                    activeEventSection.classList.remove('hidden');
                    updateActiveEventDisplay();
                    debugLog('–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –≤ —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏');
                }, 1000);

            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error);
                uploadStatus.innerHTML = '<div style="color: red; margin-top: 10px;">‚ùå –û—à–∏–±–∫–∞: ' + error + '</div>';
            }
        }

        // –ü–æ–∏—Å–∫ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–π
        function updateGuestDisplay() {
            try {
                const savedGuests = JSON.parse(localStorage.getItem('guestList')) || [];
                const checkedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];
                const filter = searchInput.value.toLowerCase();

                debugLog('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è. –í—Å–µ–≥–æ –≥–æ—Å—Ç–µ–π: ' + savedGuests.length + ', —Ñ–∏–ª—å—Ç—Ä: "' + filter + '"');

                const filteredGuests = savedGuests.filter(guest => 
                    guest.toLowerCase().includes(filter)
                );

                guestList.innerHTML = '';

                filteredGuests.forEach(guest => {
                    const guestElement = document.createElement('div');
                    guestElement.className = 'guest';
                    if (checkedGuests.includes(guest)) {
                        guestElement.classList.add('checked');
                    }
                    
                    guestElement.textContent = guest;
                    guestElement.onclick = function() {
                        toggleGuest(guest);
                    };
                    
                    guestList.appendChild(guestElement);
                });

                foundCount.textContent = filteredGuests.length;
                totalCount.textContent = savedGuests.length;

            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –≤ updateGuestDisplay: ' + error);
            }
        }

        // –û—Ç–º–µ—Ç–∫–∞ –≥–æ—Å—Ç—è
        function toggleGuest(guestName) {
            try {
                let checkedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];
                
                if (checkedGuests.includes(guestName)) {
                    checkedGuests = checkedGuests.filter(name => name !== guestName);
                    debugLog('–£–±—Ä–∞–ª–∏ –æ—Ç–º–µ—Ç–∫—É: ' + guestName);
                } else {
                    checkedGuests.push(guestName);
                    debugLog('–î–æ–±–∞–≤–∏–ª–∏ –æ—Ç–º–µ—Ç–∫—É: ' + guestName);
                }
                
                localStorage.setItem('checkedGuests', JSON.stringify(checkedGuests));
                updateGuestDisplay();
                updateCounters();
            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –≤ toggleGuest: ' + error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
        function updateCounters() {
            try {
                const checkedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];
                checkedCount.textContent = checkedGuests.length;
                debugLog('–û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—á–µ—Ç—á–∏–∫–∏. –û—Ç–º–µ—á–µ–Ω–æ: ' + checkedGuests.length);
            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –≤ updateCounters: ' + error);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç
        function showReport() {
            try {
                const checkedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];
                const allGuests = JSON.parse(localStorage.getItem('guestList')) || [];
                
                if (checkedGuests.length === 0) {
                    alert('–ù–∏–∫—Ç–æ –µ—â–µ –Ω–µ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –ø—Ä–∏—à–µ–¥—à–∏–π');
                    return;
                }

                const report = `–û–¢–ß–ï–¢\n\n${localStorage.getItem('eventName') ? `–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ: ${localStorage.getItem('eventName')}\n\n` : ''}–ü—Ä–∏—à–ª–∏ (${checkedGuests.length}/${allGuests.length}):\n\n` + 
                              checkedGuests.join('\n');
                
                alert(report);
                debugLog('–ü–æ–∫–∞–∑–∞–Ω –æ—Ç—á–µ—Ç. –ü—Ä–∏—à–ª–∏: ' + checkedGuests.length);
            } catch (error) {
                debugLog('–û—à–∏–±–∫–∞ –≤ showReport: ' + error);
            }
        }

        // –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞
        function backToUpload() {
            uploadSection.classList.remove('hidden');
            searchSection.classList.add('hidden');
            activeEventSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
            completedEventsSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            uploadStatus.innerHTML = '';
            debugLog('–í–µ—Ä–Ω—É–ª–∏—Å—å –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞');

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ"
            if (localStorage.getItem('guestList')) {
                continueActiveEventButton.style.display = 'block';
            } else {
                continueActiveEventButton.style.display = 'none';
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        function clearAllData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –í–µ—Å—å —Å–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π –∏ –æ—Ç–º–µ—Ç–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                localStorage.removeItem('guestList');
                localStorage.removeItem('checkedGuests');
                localStorage.removeItem('eventName');
                guestTextarea.value = '';
                guestList.innerHTML = '';
                searchInput.value = '';
                eventNameInput.value = '';
                eventNameDisplay.textContent = '';
                uploadSection.classList.remove('hidden');
                searchSection.classList.add('hidden');
                uploadStatus.innerHTML = '';
                debugLog('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
        function closeEvent() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                const currentEventName = localStorage.getItem('eventName');
                const currentGuestList = JSON.parse(localStorage.getItem('guestList')) || [];
                const currentCheckedGuests = JSON.parse(localStorage.getItem('checkedGuests')) || [];

                if (currentEventName || currentGuestList.length > 0) {
                    const completedEvent = {
                        name: currentEventName,
                        guestList: currentGuestList,
                        checkedGuests: currentCheckedGuests,
                        timestamp: new Date().toISOString()
                    };

                    let completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || [];
                    completedEvents.push(completedEvent);
                    localStorage.setItem('completedEvents', JSON.stringify(completedEvents));
                    debugLog('–¢–µ–∫—É—â–µ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ: ' + currentEventName);
                }

                localStorage.removeItem('guestList');
                localStorage.removeItem('checkedGuests');
                localStorage.removeItem('eventName');
                guestTextarea.value = '';
                guestList.innerHTML = '';
                searchInput.value = '';
                eventNameInput.value = '';
                eventNameDisplay.textContent = '';
                backToUpload(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∑–∫–∏
                debugLog('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
                alert('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö.');

                // –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫—Ä—ã—Ç–∞
                continueActiveEventButton.style.display = 'none';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        function displayCompletedEvents() {
            debugLog('–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π');
            const completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || [];
            completedEventsList.innerHTML = '';

            if (completedEvents.length === 0) {
                completedEventsList.innerHTML = '<p>–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</p>';
                return;
            }

            completedEvents.forEach((event, index) => {
                const eventElement = document.createElement('div');
                eventElement.className = 'section';
                eventElement.innerHTML = `
                    <h4>${event.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'} <span style="font-size: 0.8em; color: #666;">(${new Date(event.timestamp).toLocaleDateString()})</span></h4>
                    <p>–ì–æ—Å—Ç–µ–π: ${event.guestList.length}, –û—Ç–º–µ—á–µ–Ω–æ: ${event.checkedGuests.length}</p>
                    <button onclick="viewCompletedEvent(${index})">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç</button>
                `;
                completedEventsList.appendChild(eventElement);
            });
        }

        function viewCompletedEvent(index) {
            const completedEvents = JSON.parse(localStorage.getItem('completedEvents')) || [];
            const event = completedEvents[index];
            if (event) {
                const report = `–û–¢–ß–ï–¢ –î–õ–Ø –ó–ê–í–ï–†–®–ï–ù–ù–û–ì–û –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø: ${event.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}\n\n–ü—Ä–∏—à–ª–∏ (${event.checkedGuests.length}/${event.guestList.length}):\n\n` +
                              event.checkedGuests.join('\n');
                alert(report);
                debugLog('–ü–æ–∫–∞–∑–∞–Ω –æ—Ç—á–µ—Ç –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: ' + event.name);
            }
        }

        function clearCompletedEvents() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                localStorage.removeItem('completedEvents');
                displayCompletedEvents();
                debugLog('–í—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –æ—á–∏—â–µ–Ω—ã');
            }
        }

        function backToSearchFromCompleted() {
            completedEventsSection.classList.add('hidden');
            uploadSection.classList.remove('hidden'); // –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∑–∫–∏
            debugLog('–í–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é –∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π');
        }

        function showCompletedEvents() {
            uploadSection.classList.add('hidden');
            searchSection.classList.add('hidden');
            activeEventSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
            completedEventsSection.classList.remove('hidden');
            displayCompletedEvents();
            debugLog('–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π');
        }

        // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
        function continueActiveEvent() {
            uploadSection.classList.add('hidden');
            activeEventSection.classList.remove('hidden');
            updateActiveEventDisplay();
            debugLog('–ü—Ä–æ–¥–æ–ª–∂–∏–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è –≤ —Å–ø–∏—Å–æ–∫
        function addGuest() {
            const newGuestName = newGuestNameInput.value.trim();
            if (newGuestName) {
                let guestList = JSON.parse(localStorage.getItem('guestList')) || [];
                if (!guestList.includes(newGuestName)) {
                    guestList.push(newGuestName);
                    localStorage.setItem('guestList', JSON.stringify(guestList));
                    updateGuestDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–π
                    updateCounters(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                    updateActiveEventDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                    debugLog('–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –≥–æ—Å—Ç—å: ' + newGuestName);
                } else {
                    alert('–≠—Ç–æ—Ç –≥–æ—Å—Ç—å —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ.');
                    debugLog('–ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç—è, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ' + newGuestName);
                }
                newGuestNameInput.value = ''; // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è.');
                debugLog('–ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å –≥–æ—Å—Ç—è —Å –ø—É—Å—Ç—ã–º –∏–º–µ–Ω–µ–º.');
            }
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function init() {
            debugLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
            document.getElementById('loadButton').addEventListener('click', loadGuestList);
            debugLog('–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω');

            // –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–∞ –Ω–∞ –ø–æ–∏—Å–∫ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.
            // –¢–µ–ø–µ—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏.
            uploadSection.classList.remove('hidden');
            searchSection.classList.add('hidden');
            completedEventsSection.classList.add('hidden');
            activeEventSection.classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            const savedGuests = JSON.parse(localStorage.getItem('guestList'));
            if (savedGuests && savedGuests.length > 0) {
                uploadSection.classList.add('hidden');
                activeEventSection.classList.remove('hidden');
                updateActiveEventDisplay();
                debugLog('–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞: –Ω–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–≥–æ —Å–µ–∫—Ü–∏—é.');
            }

            // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ"
            if (localStorage.getItem('guestList')) {
                continueActiveEventButton.style.display = 'block';
            } else {
                continueActiveEventButton.style.display = 'none';
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
            searchInput.addEventListener('input', updateGuestDisplay);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', init);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
                    })
                    .catch(error => {
                        console.log('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            });
        }
    </script>

</body>
</html>